{"version":3,"file":"canvas-free-drawing.js","sources":["../src/index.js"],"sourcesContent":["export default class CanvasFreeDrawing {\n  constructor(params = {}) {\n    const {\n      elementId = this.requiredParam('elementId'),\n      width = this.requiredParam('width'),\n      height = this.requiredParam('height'),\n      backgroundColor = [255, 255, 255],\n      lineWidth,\n      strokeColor,\n      disabled,\n    } = params;\n\n    this.elementId = elementId;\n    this.canvas = document.getElementById(this.elementId);\n    this.checkCanvasElement();\n    this.context = this.canvas.getContext('2d', { alpha: false });\n    this.width = width;\n    this.height = height;\n\n    this.lastPath = null;\n    this.positions = [];\n    this.leftCanvasDrawing = false; // to check if user left the canvas drawing, on mouseover resume drawing\n    this.isDrawing = false;\n    this.isDrawingModeEnabled = true;\n    this.imageRestored = false;\n\n    this.lineWidth = lineWidth || 5;\n    this.strokeColor = this.validateColor(strokeColor, true);\n    this.bucketToolColor = this.validateColor(strokeColor, true);\n    this.bucketToolTolerance = 0;\n    this.isBucketToolEnabled = false;\n\n    this.listenersList = ['mouseDown', 'mouseMove', 'mouseLeave', 'mouseUp', 'touchStart', 'touchMove', 'touchEnd'];\n    this.allowedEvents = ['redraw', 'mouseup', 'mousedown', 'mouseenter', 'mouseleave'];\n    this.redrawCounter = 0;\n    this.dispatchEventsOnceEvery = 0; // this may become something like: [{event, counter}]\n\n    // initialize events\n    this.redrawEvent = new Event('cfd_redraw');\n    this.mouseUpEvent = new Event('cfd_mouseup');\n    this.mouseDownEvent = new Event('cfd_mousedown');\n    this.mouseEnterEvent = new Event('cfd_mouseenter');\n    this.mouseLeaveEvent = new Event('cfd_mouseleave');\n    this.touchStartEvent = new Event('cfd_touchstart');\n    this.touchEndEvent = new Event('cfd_touchend');\n\n    // these are needed to remove the listener\n    this.mouseDown = this.mouseDown.bind(this);\n    this.mouseMove = this.mouseMove.bind(this);\n    this.mouseLeave = this.mouseLeave.bind(this);\n    this.mouseUp = this.mouseUp.bind(this);\n    this.mouseUpDocument = this.mouseUpDocument.bind(this);\n    this.touchStart = this.touchStart.bind(this);\n    this.touchMove = this.touchMove.bind(this);\n    this.touchEnd = this.touchEnd.bind(this);\n\n    this.touchIdentifier = null;\n    this.previousX = null;\n    this.previousY = null;\n\n    this.setDimensions();\n    this.setBackground(backgroundColor);\n\n    if (!disabled) this.enableDrawingMode();\n  }\n\n  requiredParam(param) {\n    throw new Error(`${param} is required`);\n  }\n\n  checkCanvasElement() {\n    if (this.canvas.tagName !== 'CANVAS') {\n      const newCanvas = document.createElement('canvas');\n      this.canvas.appendChild(newCanvas);\n      this.canvas = newCanvas;\n    }\n  }\n\n  addListeners() {\n    this.listenersList.forEach(event => {\n      this.canvas.addEventListener(event.toLowerCase(), this[event]);\n    });\n    document.addEventListener('mouseup', this.mouseUpDocument);\n  }\n\n  removeListeners() {\n    this.listenersList.forEach(event => {\n      this.canvas.removeEventListener(event.toLowerCase(), this[event]);\n    });\n    document.removeEventListener('mouseup', this.mouseUpDocument);\n  }\n\n  enableDrawingMode() {\n    this.isDrawingModeEnabled = true;\n    this.addListeners();\n    this.toggleCursor();\n    return this.isDrawingModeEnabled;\n  }\n\n  disableDrawingMode() {\n    this.isDrawingModeEnabled = false;\n    this.removeListeners();\n    this.toggleCursor();\n    return this.isDrawingModeEnabled;\n  }\n\n  mouseDown(event) {\n    if (event.button !== 0) return;\n    const x = event.pageX - this.canvas.offsetLeft;\n    const y = event.pageY - this.canvas.offsetTop;\n    this.drawPoint(x, y);\n  }\n\n  mouseMove(event) {\n    const x = event.pageX - this.canvas.offsetLeft;\n    const y = event.pageY - this.canvas.offsetTop;\n    this.drawLine(x, y);\n  }\n\n  touchStart(event) {\n    if (event.changedTouches.length > 0) {\n      const { pageX, pageY, identifier } = event.changedTouches[0];\n      const x = pageX - this.canvas.offsetLeft;\n      const y = pageY - this.canvas.offsetTop;\n      this.touchIdentifier = identifier;\n      this.drawPoint(x, y);\n    }\n  }\n\n  touchMove(event) {\n    if (event.changedTouches.length > 0) {\n      const { pageX, pageY, identifier } = event.changedTouches[0];\n      const x = pageX - this.canvas.offsetLeft;\n      const y = pageY - this.canvas.offsetTop;\n\n      // check if is multi touch, if it is do nothing\n      if (identifier != this.touchIdentifier) return;\n\n      this.previousX = x;\n      this.previousY = y;\n      this.drawLine(x, y);\n    }\n  }\n\n  touchEnd() {\n    this.isDrawing = false;\n    this.canvas.dispatchEvent(this.touchEndEvent);\n  }\n\n  mouseUp() {\n    this.isDrawing = false;\n    this.canvas.dispatchEvent(this.mouseUpEvent);\n  }\n\n  mouseUpDocument() {\n    this.leftCanvasDrawing = false;\n  }\n\n  mouseLeave() {\n    if (this.isDrawing) this.leftCanvasDrawing = true;\n    this.isDrawing = false;\n    this.canvas.dispatchEvent(this.mouseLeaveEvent);\n  }\n\n  mouseEnter() {\n    this.canvas.dispatchEvent(this.mouseEnterEvent);\n  }\n\n  drawPoint(x, y) {\n    if (this.isBucketToolEnabled) {\n      this.fill(x, y, this.bucketToolColor, this.bucketToolTolerance);\n      return;\n    }\n    this.isDrawing = true;\n    const length = this.storeDrawing(x, y, false);\n    this.lastPath = length - 1; // index last new path\n\n    this.canvas.dispatchEvent(this.mouseDownEvent);\n\n    this.redraw();\n  }\n\n  drawLine(x, y) {\n    if (this.leftCanvasDrawing) {\n      this.leftCanvasDrawing = false;\n      this.mouseDown(event);\n    }\n\n    if (this.isDrawing) {\n      this.storeDrawing(x, y, true);\n      this.redraw(this.dispatchEventsOnceEvery);\n    }\n  }\n\n  redraw(dispatchEventsOnceEvery) {\n    this.context.strokeStyle = this.rgbaFromArray(this.strokeColor);\n    this.context.lineJoin = 'round';\n    this.context.lineWidth = this.lineWidth;\n\n    const positions = [...this.positions].slice(this.lastPath);\n    positions.forEach(({ x, y, moving }, i) => {\n      this.context.beginPath();\n      if (moving && i) {\n        this.context.moveTo(positions[i - 1]['x'], positions[i - 1]['y']);\n      } else {\n        this.context.moveTo(x - 1, y);\n      }\n      this.context.lineTo(x, y);\n      this.context.closePath();\n      this.context.stroke();\n    });\n\n    if (!dispatchEventsOnceEvery) {\n      this.canvas.dispatchEvent(this.redrawEvent);\n    } else if (this.redrawCounter % dispatchEventsOnceEvery === 0) {\n      this.canvas.dispatchEvent(this.redrawEvent);\n    }\n    this.redrawCounter += 1;\n  }\n\n  // https://en.wikipedia.org/wiki/Flood_fill\n  fill(x, y, newColor, tolerance, callback) {\n    newColor = this.validateColor(newColor);\n    if (this.positions.length === 0 && !this.imageRestored) {\n      this.setBackground(newColor, false);\n      return;\n    }\n    const imageData = this.context.getImageData(0, 0, this.width, this.height);\n    const data = imageData.data;\n    const nodeColor = this.getNodeColor(x, y, data);\n    const targetColor = this.getNodeColor(x, y, data);\n    if (this.isNodeColorEqual(targetColor, newColor, tolerance)) return;\n    if (!this.isNodeColorEqual(nodeColor, targetColor)) return;\n    const queue = [];\n    queue.push([x, y]);\n\n    while (queue.length) {\n      if (queue.length > this.width * this.height) break;\n      const n = queue.pop();\n      let w = n;\n      let e = n;\n\n      while (this.isNodeColorEqual(this.getNodeColor(w[0] - 1, w[1], data), targetColor, tolerance)) {\n        w = [w[0] - 1, w[1]];\n      }\n\n      while (this.isNodeColorEqual(this.getNodeColor(e[0] + 1, e[1], data), targetColor, tolerance)) {\n        e = [e[0] + 1, e[1]];\n      }\n\n      const firstNode = w[0];\n      const lastNode = e[0];\n\n      for (let i = firstNode; i <= lastNode; i++) {\n        this.setNodeColor(i, w[1], newColor, data);\n\n        if (this.isNodeColorEqual(this.getNodeColor(i, w[1] + 1, data), targetColor, tolerance)) {\n          queue.push([i, w[1] + 1]);\n        }\n\n        if (this.isNodeColorEqual(this.getNodeColor(i, w[1] - 1, data), targetColor, tolerance)) {\n          queue.push([i, w[1] - 1]);\n        }\n      }\n    }\n\n    this.context.putImageData(imageData, 0, 0);\n    this.canvas.dispatchEvent(this.redrawEvent);\n\n    if (typeof callback === 'function') callback();\n  }\n\n  validateColor(color, placeholder) {\n    if (typeof color === 'object' && color.length === 4) color.pop();\n    if (typeof color === 'object' && color.length === 3) {\n      const validColor = [...color];\n      validColor.push(255);\n      return validColor;\n    } else if (placeholder) {\n      return [0, 0, 0, 255];\n    }\n    console.warn('Color is not valid! It must be an array with RGB values:  [0-255, 0-255, 0-255]');\n    return null;\n  }\n\n  // i = color 1; j = color 2; t = tolerance\n  isNodeColorEqual(i, j, t) {\n    if (t) {\n      // prettier-ignore\n      return (\n        Math.abs(j[0] - i[0]) <= t &&\n        Math.abs(j[1] - i[1]) <= t &&\n        Math.abs(j[2] - i[2]) <= t\n      );\n    }\n    return i[0] === j[0] && i[1] === j[1] && i[2] === j[2] && i[3] === j[3];\n  }\n\n  getNodeColor(x, y, data) {\n    const i = (x + y * this.width) * 4;\n    return [data[i], data[i + 1], data[i + 2], data[i + 3]];\n  }\n\n  setNodeColor(x, y, color, data) {\n    const i = (x + y * this.width) * 4;\n    data[i] = color[0];\n    data[i + 1] = color[1];\n    data[i + 2] = color[2];\n    data[i + 3] = color[3];\n  }\n\n  rgbaFromArray(a) {\n    return `rgba(${a[0]},${a[1]},${a[2]},${a[3]})`;\n  }\n\n  rgbFromArray(a) {\n    return `rgb(${a[0]},${a[1]},${a[2]})`;\n  }\n\n  setDimensions() {\n    this.canvas.height = this.height;\n    this.canvas.width = this.width;\n  }\n\n  toggleCursor() {\n    this.canvas.style.cursor = this.isDrawingModeEnabled ? 'crosshair' : 'auto';\n  }\n\n  storeDrawing(x, y, moving) {\n    return this.positions.push({ x, y, moving });\n  }\n\n  // Public APIs\n\n  on(params, callback) {\n    const { event = this.requiredParam('event'), counter } = params;\n\n    if (this.allowedEvents.includes(event)) {\n      if (event === 'redraw' && Number.isInteger(counter)) {\n        this.dispatchEventsOnceEvery = parseInt(counter);\n      }\n      this.canvas.addEventListener('cfd_' + event, () => callback());\n    } else {\n      console.warn(`This event is not allowed: ${event}`);\n    }\n  }\n\n  setLineWidth(px) {\n    this.lineWidth = px;\n  }\n\n  setBackground(color, save = true) {\n    const validColor = this.validateColor(color);\n    if (validColor) {\n      if (save) this.backgroundColor = validColor;\n      this.context.fillStyle = this.rgbaFromArray(validColor);\n      this.context.fillRect(0, 0, this.width, this.height);\n    }\n  }\n\n  setDrawingColor(color) {\n    this.configBucketTool({ color });\n    this.setStrokeColor(color);\n  }\n\n  setStrokeColor(color) {\n    this.strokeColor = this.validateColor(color, true);\n  }\n\n  configBucketTool(params) {\n    const { color = null, tolerance = null } = params;\n    if (color) this.bucketToolColor = this.validateColor(color);\n    if (tolerance && tolerance > 0) this.bucketToolTolerance = tolerance;\n  }\n\n  toggleBucketTool() {\n    return (this.isBucketToolEnabled = !this.isBucketToolEnabled);\n  }\n\n  isBucketToolEnabled() {\n    return this.isBucketToolEnabled;\n  }\n\n  toggleDrawingMode() {\n    return this.isDrawingModeEnabled ? this.disableDrawingMode() : this.enableDrawingMode();\n  }\n\n  isDrawingModeEnabled() {\n    return this.isDrawingModeEnabled;\n  }\n\n  clear() {\n    this.context.clearRect(0, 0, this.width, this.height);\n    this.lastPath = null;\n    this.positions = [];\n    this.isDrawing = false;\n    this.setBackground(this.backgroundColor);\n  }\n\n  save() {\n    return this.canvas.toDataURL();\n  }\n\n  restore(backup, callback) {\n    const image = new Image();\n    image.src = backup;\n    image.onload = () => {\n      this.imageRestored = true;\n      this.context.drawImage(image, 0, 0);\n      if (typeof callback === 'function') callback();\n    };\n  }\n}\n"],"names":["CanvasFreeDrawing","params","elementId","requiredParam","width","height","backgroundColor","lineWidth","strokeColor","disabled","canvas","document","getElementById","checkCanvasElement","context","getContext","alpha","lastPath","positions","leftCanvasDrawing","isDrawing","isDrawingModeEnabled","imageRestored","validateColor","bucketToolColor","bucketToolTolerance","isBucketToolEnabled","listenersList","allowedEvents","redrawCounter","dispatchEventsOnceEvery","redrawEvent","Event","mouseUpEvent","mouseDownEvent","mouseEnterEvent","mouseLeaveEvent","touchStartEvent","touchEndEvent","mouseDown","bind","mouseMove","mouseLeave","mouseUp","mouseUpDocument","touchStart","touchMove","touchEnd","touchIdentifier","previousX","previousY","setDimensions","setBackground","enableDrawingMode","param","Error","tagName","newCanvas","createElement","appendChild","forEach","addEventListener","event","toLowerCase","removeEventListener","addListeners","toggleCursor","removeListeners","button","x","pageX","offsetLeft","y","pageY","offsetTop","drawPoint","drawLine","changedTouches","length","identifier","dispatchEvent","fill","storeDrawing","redraw","strokeStyle","rgbaFromArray","lineJoin","slice","i","moving","beginPath","moveTo","lineTo","closePath","stroke","newColor","tolerance","callback","imageData","getImageData","data","nodeColor","getNodeColor","targetColor","isNodeColorEqual","queue","push","n","pop","w","e","firstNode","lastNode","setNodeColor","putImageData","color","placeholder","validColor","console","warn","j","t","Math","abs","a","style","cursor","counter","includes","Number","isInteger","parseInt","px","save","fillStyle","fillRect","configBucketTool","setStrokeColor","disableDrawingMode","clearRect","toDataURL","backup","image","Image","src","onload","drawImage"],"mappings":"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"}