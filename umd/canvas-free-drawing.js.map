{"version":3,"file":"canvas-free-drawing.js","sources":["../src/index.js"],"sourcesContent":["var CanvasFreeDrawing = /** @class */ (function () {\n    function CanvasFreeDrawing(params) {\n        this.isNodeColorEqualCache = [];\n        var elementId = params.elementId, width = params.width, height = params.height, _a = params.backgroundColor, backgroundColor = _a === void 0 ? [255, 255, 255] : _a, _b = params.lineWidth, lineWidth = _b === void 0 ? 5 : _b, strokeColor = params.strokeColor, disabled = params.disabled, _c = params.showWarnings, showWarnings = _c === void 0 ? false : _c, _d = params.maxSnapshots, maxSnapshots = _d === void 0 ? 10 : _d;\n        this.requiredParam(params, 'elementId');\n        this.requiredParam(params, 'width');\n        this.requiredParam(params, 'height');\n        this.elementId = elementId;\n        this.canvasNode = document.getElementById(this.elementId);\n        if (this.canvasNode instanceof HTMLCanvasElement) {\n            this.canvas = this.canvasNode;\n        }\n        else if (this.canvasNode instanceof HTMLElement) {\n            var newCanvas = document.createElement('canvas');\n            this.canvasNode.appendChild(newCanvas);\n            this.canvas = newCanvas;\n        }\n        else {\n            throw new Error(\"No element found with following id: \" + this.elementId);\n        }\n        this.context = this.canvas.getContext('2d');\n        this.width = width;\n        this.height = height;\n        this.maxSnapshots = maxSnapshots;\n        this.snapshots = [];\n        this.undos = [];\n        this.positions = [];\n        this.leftCanvasDrawing = false; // to check if user left the canvas drawing, on mouseover resume drawing\n        this.isDrawing = false;\n        this.isDrawingModeEnabled = true;\n        this.imageRestored = false;\n        this.lineWidth = lineWidth;\n        this.strokeColor = this.toValidColor(strokeColor);\n        this.bucketToolColor = this.toValidColor(strokeColor);\n        this.bucketToolTolerance = 0;\n        this.isBucketToolEnabled = false;\n        this.listenersList = ['mouseDown', 'mouseMove', 'mouseLeave', 'mouseUp', 'touchStart', 'touchMove', 'touchEnd'];\n        this.allowedEvents = ['redraw', 'mouseup', 'mousedown', 'mouseenter', 'mouseleave'];\n        this.redrawCounter = 0;\n        this.dispatchEventsOnceEvery = 0; // this may become something like: [{event, counter}]\n        // initialize events\n        this.redrawEvent = new Event('cfd_redraw');\n        this.mouseUpEvent = new Event('cfd_mouseup');\n        this.mouseDownEvent = new Event('cfd_mousedown');\n        this.mouseEnterEvent = new Event('cfd_mouseenter');\n        this.mouseLeaveEvent = new Event('cfd_mouseleave');\n        this.touchStartEvent = new Event('cfd_touchstart');\n        this.touchEndEvent = new Event('cfd_touchend');\n        // these are needed to remove the listener\n        this.mouseDown = this.mouseDown.bind(this);\n        this.mouseMove = this.mouseMove.bind(this);\n        this.mouseLeave = this.mouseLeave.bind(this);\n        this.mouseUp = this.mouseUp.bind(this);\n        this.mouseUpDocument = this.mouseUpDocument.bind(this);\n        this.touchStart = this.touchStart.bind(this);\n        this.touchMove = this.touchMove.bind(this);\n        this.touchEnd = this.touchEnd.bind(this);\n        this.touchIdentifier = undefined;\n        this.previousX = undefined;\n        this.previousY = undefined;\n        this.showWarnings = showWarnings;\n        // cache\n        this.isNodeColorEqualCache = [];\n        this.setDimensions();\n        this.setBackground(backgroundColor);\n        this.storeSnapshot();\n        if (!disabled)\n            this.enableDrawingMode();\n    }\n    CanvasFreeDrawing.prototype.requiredParam = function (object, param) {\n        if (!object || !object[param]) {\n            throw new Error(param + \" is required\");\n        }\n    };\n    CanvasFreeDrawing.prototype.logWarning = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.showWarnings)\n            console.warn.apply(console, args);\n    };\n    CanvasFreeDrawing.prototype.addListeners = function () {\n        var _this = this;\n        this.listenersList.forEach(function (event) {\n            _this.canvas.addEventListener(event.toLowerCase(), _this[event]);\n        });\n        document.addEventListener('mouseup', this.mouseUpDocument);\n    };\n    CanvasFreeDrawing.prototype.removeListeners = function () {\n        var _this = this;\n        this.listenersList.forEach(function (event) {\n            _this.canvas.removeEventListener(event.toLowerCase(), _this[event]);\n        });\n        document.removeEventListener('mouseup', this.mouseUpDocument);\n    };\n    CanvasFreeDrawing.prototype.enableDrawingMode = function () {\n        this.isDrawingModeEnabled = true;\n        this.addListeners();\n        this.toggleCursor();\n        return this.isDrawingModeEnabled;\n    };\n    CanvasFreeDrawing.prototype.disableDrawingMode = function () {\n        this.isDrawingModeEnabled = false;\n        this.removeListeners();\n        this.toggleCursor();\n        return this.isDrawingModeEnabled;\n    };\n    CanvasFreeDrawing.prototype.mouseDown = function (event) {\n        if (event.button !== 0)\n            return;\n        var x = event.pageX - this.canvas.offsetLeft;\n        var y = event.pageY - this.canvas.offsetTop;\n        return this.drawPoint(x, y);\n    };\n    CanvasFreeDrawing.prototype.mouseMove = function (event) {\n        var x = event.pageX - this.canvas.offsetLeft;\n        var y = event.pageY - this.canvas.offsetTop;\n        this.drawLine(x, y, event);\n    };\n    CanvasFreeDrawing.prototype.touchStart = function (event) {\n        if (event.changedTouches.length > 0) {\n            var _a = event.changedTouches[0], pageX = _a.pageX, pageY = _a.pageY, identifier = _a.identifier;\n            var x = pageX - this.canvas.offsetLeft;\n            var y = pageY - this.canvas.offsetTop;\n            this.touchIdentifier = identifier;\n            return this.drawPoint(x, y);\n        }\n    };\n    CanvasFreeDrawing.prototype.touchMove = function (event) {\n        if (event.changedTouches.length > 0) {\n            var _a = event.changedTouches[0], pageX = _a.pageX, pageY = _a.pageY, identifier = _a.identifier;\n            var x = pageX - this.canvas.offsetLeft;\n            var y = pageY - this.canvas.offsetTop;\n            // check if is multi touch, if it is do nothing\n            if (identifier != this.touchIdentifier)\n                return;\n            this.previousX = x;\n            this.previousY = y;\n            this.drawLine(x, y, event);\n        }\n    };\n    CanvasFreeDrawing.prototype.touchEnd = function () {\n        this.handleEndDrawing();\n        this.canvas.dispatchEvent(this.touchEndEvent);\n    };\n    CanvasFreeDrawing.prototype.mouseUp = function () {\n        this.handleEndDrawing();\n        this.canvas.dispatchEvent(this.mouseUpEvent);\n    };\n    CanvasFreeDrawing.prototype.mouseUpDocument = function () {\n        this.leftCanvasDrawing = false;\n    };\n    CanvasFreeDrawing.prototype.mouseLeave = function () {\n        if (this.isDrawing)\n            this.leftCanvasDrawing = true;\n        this.isDrawing = false;\n        this.canvas.dispatchEvent(this.mouseLeaveEvent);\n    };\n    CanvasFreeDrawing.prototype.mouseEnter = function () {\n        this.canvas.dispatchEvent(this.mouseEnterEvent);\n    };\n    CanvasFreeDrawing.prototype.handleEndDrawing = function () {\n        this.isDrawing = false;\n        this.storeSnapshot();\n    };\n    CanvasFreeDrawing.prototype.drawPoint = function (x, y) {\n        if (this.isBucketToolEnabled) {\n            return this.fill(x, y, this.bucketToolColor, { tolerance: this.bucketToolTolerance });\n        }\n        this.isDrawing = true;\n        this.storeDrawing(x, y, false);\n        this.canvas.dispatchEvent(this.mouseDownEvent);\n        this.handleDrawing(this.dispatchEventsOnceEvery);\n    };\n    CanvasFreeDrawing.prototype.drawLine = function (x, y, event) {\n        if (this.leftCanvasDrawing) {\n            this.leftCanvasDrawing = false;\n            if (event instanceof MouseEvent) {\n                this.mouseDown(event);\n            }\n            else if (event instanceof TouchEvent) {\n                this.touchEnd();\n            }\n        }\n        if (this.isDrawing) {\n            this.storeDrawing(x, y, true);\n            this.handleDrawing(this.dispatchEventsOnceEvery);\n        }\n    };\n    CanvasFreeDrawing.prototype.handleDrawing = function (dispatchEventsOnceEvery) {\n        var _this = this;\n        this.context.lineJoin = 'round';\n        var positions = [this.positions.slice().pop()];\n        positions.forEach(function (position) {\n            if (position && position[0] && position[0].strokeColor) {\n                _this.context.strokeStyle = _this.rgbaFromArray(position[0].strokeColor);\n                _this.context.lineWidth = position[0].lineWidth;\n                _this.draw(position);\n            }\n        });\n        if (!dispatchEventsOnceEvery) {\n            this.canvas.dispatchEvent(this.redrawEvent);\n        }\n        else if (this.redrawCounter % dispatchEventsOnceEvery === 0) {\n            this.canvas.dispatchEvent(this.redrawEvent);\n        }\n        this.undos = [];\n        this.redrawCounter += 1;\n    };\n    CanvasFreeDrawing.prototype.draw = function (position) {\n        var _this = this;\n        position.forEach(function (_a, i) {\n            var x = _a.x, y = _a.y, moving = _a.moving;\n            _this.context.beginPath();\n            if (moving && i) {\n                _this.context.moveTo(position[i - 1]['x'], position[i - 1]['y']);\n            }\n            else {\n                _this.context.moveTo(x - 1, y);\n            }\n            _this.context.lineTo(x, y);\n            _this.context.closePath();\n            _this.context.stroke();\n        });\n    };\n    // https://en.wikipedia.org/wiki/Flood_fill\n    CanvasFreeDrawing.prototype.fill = function (x, y, newColor, _a) {\n        var _this = this;\n        var tolerance = _a.tolerance;\n        return new Promise(function (resolve) {\n            newColor = _this.toValidColor(newColor);\n            if (_this.positions.length === 0 && !_this.imageRestored) {\n                _this.setBackground(newColor, false);\n                _this.canvas.dispatchEvent(_this.redrawEvent);\n                return;\n            }\n            var imageData = _this.context.getImageData(0, 0, _this.width, _this.height);\n            var newData = imageData.data;\n            var targetColor = _this.getNodeColor(x, y, newData);\n            if (_this.isNodeColorEqual(targetColor, newColor, tolerance))\n                return;\n            var queue = [];\n            queue.push([x, y]);\n            while (queue.length) {\n                if (queue.length > _this.width * _this.height)\n                    break;\n                var n = queue.pop();\n                var w = n;\n                var e = n;\n                while (_this.isNodeColorEqual(_this.getNodeColor(w[0] - 1, w[1], newData), targetColor, tolerance)) {\n                    w = [w[0] - 1, w[1]];\n                }\n                while (_this.isNodeColorEqual(_this.getNodeColor(e[0] + 1, e[1], newData), targetColor, tolerance)) {\n                    e = [e[0] + 1, e[1]];\n                }\n                var firstNode = w[0];\n                var lastNode = e[0];\n                for (var i = firstNode; i <= lastNode; i++) {\n                    _this.setNodeColor(i, w[1], newColor, newData);\n                    if (_this.isNodeColorEqual(_this.getNodeColor(i, w[1] + 1, newData), targetColor, tolerance)) {\n                        queue.push([i, w[1] + 1]);\n                    }\n                    if (_this.isNodeColorEqual(_this.getNodeColor(i, w[1] - 1, newData), targetColor, tolerance)) {\n                        queue.push([i, w[1] - 1]);\n                    }\n                }\n            }\n            _this.context.putImageData(imageData, 0, 0);\n            _this.canvas.dispatchEvent(_this.redrawEvent);\n            resolve(true);\n        });\n    };\n    CanvasFreeDrawing.prototype.toValidColor = function (color) {\n        if (Array.isArray(color) && color.length === 4)\n            color.pop();\n        if (Array.isArray(color) && color.length === 3) {\n            var validColor = color.slice();\n            validColor.push(255);\n            return validColor;\n        }\n        else {\n            this.logWarning('Color is not valid! It must be an array with RGB values:  [0-255, 0-255, 0-255]');\n            return [0, 0, 0, 255];\n        }\n    };\n    // i = color 1; j = color 2; t = tolerance\n    CanvasFreeDrawing.prototype.isNodeColorEqual = function (i, j, t) {\n        // const color1 = JSON.stringify(i);\n        // const color2 = JSON.stringify(j);\n        var color1 = '' + i[0] + i[1] + i[2] + i[3];\n        var color2 = '' + j[0] + j[1] + j[2] + j[3];\n        var key = color1 + color2 + t;\n        t = t || 0;\n        if (this.isNodeColorEqualCache.hasOwnProperty(color1 + color2 + t)) {\n            return this.isNodeColorEqualCache[key];\n        }\n        var diffRed = Math.abs(j[0] - i[0]);\n        var diffGreen = Math.abs(j[1] - i[1]);\n        var diffBlue = Math.abs(j[2] - i[2]);\n        var percentDiffRed = diffRed / 255;\n        var percentDiffGreen = diffGreen / 255;\n        var percentDiffBlue = diffBlue / 255;\n        var percentDiff = ((percentDiffRed + percentDiffGreen + percentDiffBlue) / 3) * 100;\n        var result = t >= percentDiff;\n        this.isNodeColorEqualCache[key] = result;\n        return result;\n    };\n    CanvasFreeDrawing.prototype.getNodeColor = function (x, y, data) {\n        var i = (x + y * this.width) * 4;\n        return [data[i], data[i + 1], data[i + 2], data[i + 3]];\n    };\n    CanvasFreeDrawing.prototype.setNodeColor = function (x, y, color, data) {\n        var i = (x + y * this.width) * 4;\n        data[i] = color[0];\n        data[i + 1] = color[1];\n        data[i + 2] = color[2];\n        data[i + 3] = color[3];\n    };\n    CanvasFreeDrawing.prototype.rgbaFromArray = function (a) {\n        return \"rgba(\" + a[0] + \",\" + a[1] + \",\" + a[2] + \",\" + a[3] + \")\";\n    };\n    CanvasFreeDrawing.prototype.setDimensions = function () {\n        this.canvas.height = this.height;\n        this.canvas.width = this.width;\n    };\n    CanvasFreeDrawing.prototype.toggleCursor = function () {\n        this.canvas.style.cursor = this.isDrawingModeEnabled ? 'crosshair' : 'auto';\n    };\n    CanvasFreeDrawing.prototype.storeDrawing = function (x, y, moving) {\n        if (moving) {\n            var lastIndex = this.positions.length - 1;\n            this.positions[lastIndex].push({\n                x: x,\n                y: y,\n                moving: moving,\n                lineWidth: this.lineWidth,\n                strokeColor: this.strokeColor,\n                isBucket: false\n            });\n        }\n        else {\n            this.positions.push([\n                {\n                    x: x,\n                    y: y,\n                    isBucket: false,\n                    moving: moving,\n                    lineWidth: this.lineWidth,\n                    strokeColor: this.strokeColor\n                },\n            ]);\n        }\n    };\n    CanvasFreeDrawing.prototype.storeSnapshot = function () {\n        var _this = this;\n        new Promise(function (resolve) {\n            var imageData = _this.getCanvasSnapshot();\n            _this.snapshots.push(imageData);\n            if (_this.snapshots.length > _this.maxSnapshots) {\n                _this.snapshots = _this.snapshots.splice(-Math.abs(_this.maxSnapshots));\n            }\n            resolve();\n        });\n    };\n    CanvasFreeDrawing.prototype.getCanvasSnapshot = function () {\n        return this.context.getImageData(0, 0, this.width, this.height);\n    };\n    CanvasFreeDrawing.prototype.restoreCanvasSnapshot = function (imageData) {\n        this.context.putImageData(imageData, 0, 0);\n    };\n    // Public APIs\n    CanvasFreeDrawing.prototype.on = function (params, callback) {\n        var event = params.event, counter = params.counter;\n        this.requiredParam(params, 'event');\n        if (this.allowedEvents.includes(event)) {\n            if (event === 'redraw' && counter && Number.isInteger(counter)) {\n                this.dispatchEventsOnceEvery = counter;\n            }\n            this.canvas.addEventListener('cfd_' + event, function () { return callback(); });\n        }\n        else {\n            this.logWarning(\"This event is not allowed: \" + event);\n        }\n    };\n    CanvasFreeDrawing.prototype.setLineWidth = function (px) {\n        this.lineWidth = px;\n    };\n    CanvasFreeDrawing.prototype.setBackground = function (color, save) {\n        if (save === void 0) { save = true; }\n        var validColor = this.toValidColor(color);\n        if (validColor) {\n            if (save)\n                this.backgroundColor = validColor;\n            this.context.fillStyle = this.rgbaFromArray(validColor);\n            this.context.fillRect(0, 0, this.width, this.height);\n        }\n    };\n    CanvasFreeDrawing.prototype.setDrawingColor = function (color) {\n        this.configBucketTool({ color: color });\n        this.setStrokeColor(color);\n    };\n    CanvasFreeDrawing.prototype.setStrokeColor = function (color) {\n        this.strokeColor = this.toValidColor(color);\n    };\n    CanvasFreeDrawing.prototype.configBucketTool = function (params) {\n        var _a = params.color, color = _a === void 0 ? null : _a, _b = params.tolerance, tolerance = _b === void 0 ? null : _b;\n        if (color)\n            this.bucketToolColor = this.toValidColor(color);\n        if (tolerance && tolerance > 0) {\n            this.bucketToolTolerance = tolerance > 100 ? 100 : tolerance;\n        }\n    };\n    CanvasFreeDrawing.prototype.toggleBucketTool = function () {\n        return (this.isBucketToolEnabled = !this.isBucketToolEnabled);\n    };\n    CanvasFreeDrawing.prototype.toggleDrawingMode = function () {\n        return this.isDrawingModeEnabled ? this.disableDrawingMode() : this.enableDrawingMode();\n    };\n    CanvasFreeDrawing.prototype.clear = function () {\n        this.context.clearRect(0, 0, this.width, this.height);\n        this.positions = [];\n        if (this.backgroundColor)\n            this.setBackground(this.backgroundColor);\n        this.handleEndDrawing();\n    };\n    CanvasFreeDrawing.prototype.save = function () {\n        return this.canvas.toDataURL();\n    };\n    CanvasFreeDrawing.prototype.restore = function (backup, callback) {\n        var _this = this;\n        var image = new Image();\n        image.src = backup;\n        image.onload = function () {\n            _this.imageRestored = true;\n            _this.context.drawImage(image, 0, 0);\n            if (typeof callback === 'function')\n                callback();\n        };\n    };\n    CanvasFreeDrawing.prototype.undo = function () {\n        var lastSnapshot = this.snapshots[this.snapshots.length - 1];\n        var goToSnapshot = this.snapshots[this.snapshots.length - 2];\n        if (goToSnapshot) {\n            this.restoreCanvasSnapshot(goToSnapshot);\n            this.snapshots.pop();\n            this.undos.push(lastSnapshot);\n            this.undos = this.undos.splice(-Math.abs(this.maxSnapshots));\n        }\n        else {\n            this.logWarning('There are no more undos left.');\n        }\n    };\n    CanvasFreeDrawing.prototype.redo = function () {\n        if (this.undos.length > 0) {\n            var lastUndo = this.undos.pop();\n            if (lastUndo) {\n                this.restoreCanvasSnapshot(lastUndo);\n                this.snapshots.push(lastUndo);\n                this.snapshots = this.snapshots.splice(-Math.abs(this.maxSnapshots));\n            }\n        }\n        else {\n            this.logWarning('There are no more redo left.');\n        }\n    };\n    return CanvasFreeDrawing;\n}());\nexport default CanvasFreeDrawing;\n"],"names":["CanvasFreeDrawing","params","isNodeColorEqualCache","elementId","width","height","_a","backgroundColor","_b","lineWidth","strokeColor","disabled","_c","showWarnings","_d","maxSnapshots","requiredParam","canvasNode","document","getElementById","HTMLCanvasElement","canvas","HTMLElement","newCanvas","createElement","appendChild","Error","context","getContext","snapshots","undos","positions","leftCanvasDrawing","isDrawing","isDrawingModeEnabled","imageRestored","toValidColor","bucketToolColor","bucketToolTolerance","isBucketToolEnabled","listenersList","allowedEvents","redrawCounter","dispatchEventsOnceEvery","redrawEvent","Event","mouseUpEvent","mouseDownEvent","mouseEnterEvent","mouseLeaveEvent","touchStartEvent","touchEndEvent","mouseDown","bind","mouseMove","mouseLeave","mouseUp","mouseUpDocument","touchStart","touchMove","touchEnd","touchIdentifier","undefined","previousX","previousY","setDimensions","setBackground","storeSnapshot","enableDrawingMode","prototype","object","param","logWarning","args","_i","arguments","length","console","warn","apply","addListeners","_this","forEach","event","addEventListener","toLowerCase","removeListeners","removeEventListener","toggleCursor","disableDrawingMode","button","x","pageX","offsetLeft","y","pageY","offsetTop","drawPoint","drawLine","changedTouches","identifier","handleEndDrawing","dispatchEvent","mouseEnter","fill","tolerance","storeDrawing","handleDrawing","MouseEvent","TouchEvent","lineJoin","slice","pop","position","strokeStyle","rgbaFromArray","draw","i","moving","beginPath","moveTo","lineTo","closePath","stroke","newColor","Promise","resolve","imageData","getImageData","newData","data","targetColor","getNodeColor","isNodeColorEqual","queue","push","n","w","e","firstNode","lastNode","setNodeColor","putImageData","color","Array","isArray","validColor","j","t","color1","color2","key","hasOwnProperty","diffRed","Math","abs","diffGreen","diffBlue","percentDiffRed","percentDiffGreen","percentDiffBlue","percentDiff","result","a","style","cursor","lastIndex","isBucket","getCanvasSnapshot","splice","restoreCanvasSnapshot","on","callback","counter","includes","Number","isInteger","setLineWidth","px","save","fillStyle","fillRect","setDrawingColor","configBucketTool","setStrokeColor","toggleBucketTool","toggleDrawingMode","clear","clearRect","toDataURL","restore","backup","image","Image","src","onload","drawImage","undo","lastSnapshot","goToSnapshot","redo","lastUndo"],"mappings":"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"}