{"version":3,"file":"canvas-free-drawing.js","sources":["../src/index.js"],"sourcesContent":["export default class CanvasFreeDrawing {\n  constructor(params = {}) {\n    const {\n      elementId = this.requiredParam('elementId'),\n      width = this.requiredParam('width'),\n      height = this.requiredParam('height'),\n      backgroundColor = [255, 255, 255],\n      lineWidth,\n      strokeColor,\n      disabled,\n    } = params;\n\n    this.elementId = elementId;\n    this.canvas = document.getElementById(this.elementId);\n    this.checkCanvasElement();\n    this.context = this.canvas.getContext('2d', { alpha: false });\n    this.width = width;\n    this.height = height;\n\n    this.maxSnapshots = 10;\n    this.snapshots = [];\n    this.undos = [];\n    this.positions = [];\n    this.leftCanvasDrawing = false; // to check if user left the canvas drawing, on mouseover resume drawing\n    this.isDrawing = false;\n    this.isDrawingModeEnabled = true;\n    this.imageRestored = false;\n\n    this.lineWidth = lineWidth || 5;\n    this.strokeColor = this.validateColor(strokeColor, true);\n    this.bucketToolColor = this.validateColor(strokeColor, true);\n    this.bucketToolTolerance = 0;\n    this.isBucketToolEnabled = false;\n\n    this.listenersList = ['mouseDown', 'mouseMove', 'mouseLeave', 'mouseUp', 'touchStart', 'touchMove', 'touchEnd'];\n    this.allowedEvents = ['redraw', 'mouseup', 'mousedown', 'mouseenter', 'mouseleave'];\n    this.redrawCounter = 0;\n    this.dispatchEventsOnceEvery = 0; // this may become something like: [{event, counter}]\n\n    // initialize events\n    this.redrawEvent = new Event('cfd_redraw');\n    this.mouseUpEvent = new Event('cfd_mouseup');\n    this.mouseDownEvent = new Event('cfd_mousedown');\n    this.mouseEnterEvent = new Event('cfd_mouseenter');\n    this.mouseLeaveEvent = new Event('cfd_mouseleave');\n    this.touchStartEvent = new Event('cfd_touchstart');\n    this.touchEndEvent = new Event('cfd_touchend');\n\n    // these are needed to remove the listener\n    this.mouseDown = this.mouseDown.bind(this);\n    this.mouseMove = this.mouseMove.bind(this);\n    this.mouseLeave = this.mouseLeave.bind(this);\n    this.mouseUp = this.mouseUp.bind(this);\n    this.mouseUpDocument = this.mouseUpDocument.bind(this);\n    this.touchStart = this.touchStart.bind(this);\n    this.touchMove = this.touchMove.bind(this);\n    this.touchEnd = this.touchEnd.bind(this);\n\n    this.touchIdentifier = null;\n    this.previousX = null;\n    this.previousY = null;\n\n    this.setDimensions();\n    this.setBackground(backgroundColor);\n\n    if (!disabled) this.enableDrawingMode();\n  }\n\n  requiredParam(param) {\n    throw new Error(`${param} is required`);\n  }\n\n  checkCanvasElement() {\n    if (this.canvas.tagName !== 'CANVAS') {\n      const newCanvas = document.createElement('canvas');\n      this.canvas.appendChild(newCanvas);\n      this.canvas = newCanvas;\n    }\n  }\n\n  addListeners() {\n    this.listenersList.forEach(event => {\n      this.canvas.addEventListener(event.toLowerCase(), this[event]);\n    });\n    document.addEventListener('mouseup', this.mouseUpDocument);\n  }\n\n  removeListeners() {\n    this.listenersList.forEach(event => {\n      this.canvas.removeEventListener(event.toLowerCase(), this[event]);\n    });\n    document.removeEventListener('mouseup', this.mouseUpDocument);\n  }\n\n  enableDrawingMode() {\n    this.isDrawingModeEnabled = true;\n    this.addListeners();\n    this.toggleCursor();\n    return this.isDrawingModeEnabled;\n  }\n\n  disableDrawingMode() {\n    this.isDrawingModeEnabled = false;\n    this.removeListeners();\n    this.toggleCursor();\n    return this.isDrawingModeEnabled;\n  }\n\n  mouseDown(event) {\n    if (event.button !== 0) return;\n    const x = event.pageX - this.canvas.offsetLeft;\n    const y = event.pageY - this.canvas.offsetTop;\n    this.drawPoint(x, y);\n  }\n\n  mouseMove(event) {\n    const x = event.pageX - this.canvas.offsetLeft;\n    const y = event.pageY - this.canvas.offsetTop;\n    this.drawLine(x, y);\n  }\n\n  touchStart(event) {\n    if (event.changedTouches.length > 0) {\n      const { pageX, pageY, identifier } = event.changedTouches[0];\n      const x = pageX - this.canvas.offsetLeft;\n      const y = pageY - this.canvas.offsetTop;\n      this.touchIdentifier = identifier;\n      this.drawPoint(x, y);\n    }\n  }\n\n  touchMove(event) {\n    if (event.changedTouches.length > 0) {\n      const { pageX, pageY, identifier } = event.changedTouches[0];\n      const x = pageX - this.canvas.offsetLeft;\n      const y = pageY - this.canvas.offsetTop;\n\n      // check if is multi touch, if it is do nothing\n      if (identifier != this.touchIdentifier) return;\n\n      this.previousX = x;\n      this.previousY = y;\n      this.drawLine(x, y);\n    }\n  }\n\n  touchEnd() {\n    this.handleEndDrawing();\n    this.canvas.dispatchEvent(this.touchEndEvent);\n  }\n\n  mouseUp() {\n    this.handleEndDrawing();\n    this.canvas.dispatchEvent(this.mouseUpEvent);\n  }\n\n  mouseUpDocument() {\n    this.leftCanvasDrawing = false;\n  }\n\n  mouseLeave() {\n    if (this.isDrawing) this.leftCanvasDrawing = true;\n    this.isDrawing = false;\n    this.canvas.dispatchEvent(this.mouseLeaveEvent);\n  }\n\n  mouseEnter() {\n    this.canvas.dispatchEvent(this.mouseEnterEvent);\n  }\n\n  handleEndDrawing() {\n    this.isDrawing = false;\n    this.storeSnapshot();\n  }\n\n  drawPoint(x, y) {\n    if (this.isBucketToolEnabled) {\n      this.fill(x, y, this.bucketToolColor, { tolerance: this.bucketToolTolerance });\n      return;\n    }\n    this.isDrawing = true;\n    this.storeDrawing(x, y, false);\n\n    this.canvas.dispatchEvent(this.mouseDownEvent);\n\n    this.handleDrawing();\n  }\n\n  drawLine(x, y) {\n    if (this.leftCanvasDrawing) {\n      this.leftCanvasDrawing = false;\n      this.mouseDown(event);\n    }\n\n    if (this.isDrawing) {\n      this.storeDrawing(x, y, true);\n      this.handleDrawing({ dispatchEventsOnceEvery: this.dispatchEventsOnceEvery });\n    }\n  }\n\n  handleDrawingHistory({ isUndo, isRedo } = {}) {\n    this.clear({ onlyCanvas: true });\n\n    if (isUndo) {\n      if (this.positions.length === 0) return;\n      const undo = this.positions.pop();\n      this.snapshots.push(undo);\n    }\n\n    if (isRedo) {\n      if (this.snapshots.length === 0) return;\n      this.positions.push(this.snapshots[this.snapshots.length - 1]);\n      this.snapshots.pop();\n    }\n\n    const positions = [...this.positions];\n    positions.forEach((position, i) => {\n      if (position.isBucket) {\n        const { x, y, newColor, tolerance } = position;\n        this.fill(x, y, newColor, { tolerance, storeInPosition: false });\n      } else {\n        this.context.strokeStyle = this.rgbaFromArray(position[0].strokeColor);\n        this.context.lineWidth = position[0].lineWidth;\n        this.draw(position);\n      }\n    });\n  }\n\n  handleDrawing({ dispatchEventsOnceEvery } = {}) {\n    this.context.lineJoin = 'round';\n    const positions = [[...this.positions].pop()];\n\n    positions.forEach(position => {\n      this.context.strokeStyle = this.rgbaFromArray(position[0].strokeColor);\n      this.context.lineWidth = position[0].lineWidth;\n\n      this.draw(position);\n    });\n\n    if (!dispatchEventsOnceEvery) {\n      this.canvas.dispatchEvent(this.redrawEvent);\n    } else if (this.redrawCounter % dispatchEventsOnceEvery === 0) {\n      this.canvas.dispatchEvent(this.redrawEvent);\n    }\n\n    this.undos = [];\n    this.redrawCounter += 1;\n  }\n\n  draw(position) {\n    position.forEach(({ x, y, moving }, i) => {\n      this.context.beginPath();\n      if (moving && i) {\n        this.context.moveTo(position[i - 1]['x'], position[i - 1]['y']);\n      } else {\n        this.context.moveTo(x - 1, y);\n      }\n      this.context.lineTo(x, y);\n      this.context.closePath();\n      this.context.stroke();\n    });\n  }\n\n  // https://en.wikipedia.org/wiki/Flood_fill\n  fill(x, y, newColor, { tolerance, storeInPosition = true }) {\n    console.log(x, y, newColor, tolerance, storeInPosition);\n    return new Promise(resolve => {\n      newColor = this.validateColor(newColor);\n      if (this.positions.length === 0 && !this.imageRestored) {\n        this.setBackground(newColor, false);\n        return;\n      }\n      const imageData = this.context.getImageData(0, 0, this.width, this.height);\n      const data = imageData.data;\n      const targetColor = this.getNodeColor(x, y, data);\n      if (this.isNodeColorEqual(targetColor, newColor, tolerance)) return;\n      // if (!this.isNodeColorEqual(nodeColor, targetColor)) return;\n      const queue = [];\n      queue.push([x, y]);\n\n      while (queue.length) {\n        if (queue.length > this.width * this.height) break;\n        const n = queue.pop();\n        let w = n;\n        let e = n;\n\n        while (this.isNodeColorEqual(this.getNodeColor(w[0] - 1, w[1], data), targetColor, tolerance)) {\n          w = [w[0] - 1, w[1]];\n        }\n\n        while (this.isNodeColorEqual(this.getNodeColor(e[0] + 1, e[1], data), targetColor, tolerance)) {\n          e = [e[0] + 1, e[1]];\n        }\n\n        const firstNode = w[0];\n        const lastNode = e[0];\n\n        for (let i = firstNode; i <= lastNode; i++) {\n          this.setNodeColor(i, w[1], newColor, data);\n\n          if (this.isNodeColorEqual(this.getNodeColor(i, w[1] + 1, data), targetColor, tolerance)) {\n            queue.push([i, w[1] + 1]);\n          }\n\n          if (this.isNodeColorEqual(this.getNodeColor(i, w[1] - 1, data), targetColor, tolerance)) {\n            queue.push([i, w[1] - 1]);\n          }\n        }\n      }\n\n      this.context.putImageData(imageData, 0, 0);\n      this.canvas.dispatchEvent(this.redrawEvent);\n\n      if (storeInPosition) {\n        this.positions.push({ isBucket: true, x, y, newColor, tolerance });\n      }\n\n      this.storeSnapshot();\n      resolve();\n    });\n  }\n\n  validateColor(color, placeholder) {\n    if (typeof color === 'object' && color.length === 4) color.pop();\n    if (typeof color === 'object' && color.length === 3) {\n      const validColor = [...color];\n      validColor.push(255);\n      return validColor;\n    } else if (placeholder) {\n      return [0, 0, 0, 255];\n    }\n    console.warn('Color is not valid! It must be an array with RGB values:  [0-255, 0-255, 0-255]');\n    return null;\n  }\n\n  // i = color 1; j = color 2; t = tolerance\n  isNodeColorEqual(i, j, t) {\n    if (t) {\n      const percentT = (t / 255) * 100;\n      const diffRed = Math.abs(j[0] - i[0]);\n      const diffGreen = Math.abs(j[1] - i[1]);\n      const diffBlue = Math.abs(j[2] - i[2]);\n\n      const percentDiffRed = diffRed / 255;\n      const percentDiffGreen = diffGreen / 255;\n      const percentDiffBlue = diffBlue / 255;\n\n      const percentDiff = ((percentDiffRed + percentDiffGreen + percentDiffBlue) / 3) * 100;\n      return percentT >= percentDiff;\n    }\n\n    const color1 = `${i[0] + i[1] + i[2] + i[3]}`;\n    const color2 = `${j[0] + j[1] + j[2] + j[3]}`;\n    return color1 === color2;\n  }\n\n  getNodeColor(x, y, data) {\n    const i = (x + y * this.width) * 4;\n    return [data[i], data[i + 1], data[i + 2], data[i + 3]];\n  }\n\n  setNodeColor(x, y, color, data) {\n    const i = (x + y * this.width) * 4;\n    data[i] = color[0];\n    data[i + 1] = color[1];\n    data[i + 2] = color[2];\n    data[i + 3] = color[3];\n  }\n\n  rgbaFromArray(a) {\n    return `rgba(${a[0]},${a[1]},${a[2]},${a[3]})`;\n  }\n\n  rgbFromArray(a) {\n    return `rgb(${a[0]},${a[1]},${a[2]})`;\n  }\n\n  setDimensions() {\n    this.canvas.height = this.height;\n    this.canvas.width = this.width;\n  }\n\n  toggleCursor() {\n    this.canvas.style.cursor = this.isDrawingModeEnabled ? 'crosshair' : 'auto';\n  }\n\n  storeDrawing(x, y, moving) {\n    if (moving) {\n      this.positions[this.positions.length - 1].push({\n        x,\n        y,\n        moving,\n        lineWidth: this.lineWidth,\n        strokeColor: this.strokeColor,\n      });\n    } else {\n      this.positions.push([\n        {\n          x,\n          y,\n          moving,\n          lineWidth: this.lineWidth,\n          strokeColor: this.strokeColor,\n        },\n      ]);\n    }\n  }\n\n  storeSnapshot() {\n    console.log('storeSnapshot');\n    new Promise(resolve => {\n      const imageData = this.getCanvasSnapshot();\n      this.snapshots.push(imageData);\n      if (this.snapshots.length > 10) {\n        this.snapshots.splice(-this.maxSnapshots);\n      }\n      resolve();\n    });\n  }\n\n  getCanvasSnapshot() {\n    return this.context.getImageData(0, 0, this.width, this.height);\n  }\n\n  restoreCanvasSnapshot(imageData) {\n    this.context.putImageData(imageData, 0, 0);\n  }\n\n  // Public APIs\n\n  on(params, callback) {\n    const { event = this.requiredParam('event'), counter } = params;\n\n    if (this.allowedEvents.includes(event)) {\n      if (event === 'redraw' && Number.isInteger(counter)) {\n        this.dispatchEventsOnceEvery = parseInt(counter);\n      }\n      this.canvas.addEventListener('cfd_' + event, () => callback());\n    } else {\n      console.warn(`This event is not allowed: ${event}`);\n    }\n  }\n\n  setLineWidth(px) {\n    this.lineWidth = px;\n  }\n\n  setBackground(color, save = true) {\n    const validColor = this.validateColor(color);\n    if (validColor) {\n      if (save) this.backgroundColor = validColor;\n      this.context.fillStyle = this.rgbaFromArray(validColor);\n      this.context.fillRect(0, 0, this.width, this.height);\n    }\n  }\n\n  setDrawingColor(color) {\n    this.configBucketTool({ color });\n    this.setStrokeColor(color);\n  }\n\n  setStrokeColor(color) {\n    this.strokeColor = this.validateColor(color, true);\n  }\n\n  configBucketTool(params) {\n    const { color = null, tolerance = null } = params;\n    if (color) this.bucketToolColor = this.validateColor(color);\n    if (tolerance && tolerance > 0) this.bucketToolTolerance = tolerance;\n  }\n\n  toggleBucketTool() {\n    return (this.isBucketToolEnabled = !this.isBucketToolEnabled);\n  }\n\n  isBucketToolEnabled() {\n    return this.isBucketToolEnabled;\n  }\n\n  toggleDrawingMode() {\n    return this.isDrawingModeEnabled ? this.disableDrawingMode() : this.enableDrawingMode();\n  }\n\n  isDrawingModeEnabled() {\n    return this.isDrawingModeEnabled;\n  }\n\n  clear({ onlyCanvas } = {}) {\n    this.context.clearRect(0, 0, this.width, this.height);\n\n    if (!onlyCanvas) {\n      this.lastPath = [];\n      this.positions = [];\n      this.handleEndDrawing();\n      this.setBackground(this.backgroundColor);\n    }\n  }\n\n  save() {\n    return this.canvas.toDataURL();\n  }\n\n  restore(backup, callback) {\n    const image = new Image();\n    image.src = backup;\n    image.onload = () => {\n      this.imageRestored = true;\n      this.context.drawImage(image, 0, 0);\n      if (typeof callback === 'function') callback();\n    };\n  }\n\n  undo() {\n    console.log('undo');\n    const lastSnapshot = this.snapshots[this.snapshots.length - 1];\n    const goToSnapshot = this.snapshots[this.snapshots.length - 2];\n    if (goToSnapshot) {\n      console.log('in goToSnapshot');\n      this.restoreCanvasSnapshot(goToSnapshot);\n      this.snapshots.pop();\n      this.undos.push(lastSnapshot);\n      this.undos = this.undos.splice(-Math.abs(this.maxSnapshots));\n    } else {\n      console.warn('There are no more undos left.');\n    }\n  }\n\n  redo() {\n    console.log('redo');\n    if (this.undos.length > 0) {\n      console.log('in redo > 0');\n      const lastUndo = this.undos.pop();\n      this.restoreCanvasSnapshot(lastUndo);\n      this.snapshots.push(lastUndo);\n      this.snapshots = this.snapshots.splice(-Math.abs(this.maxSnapshots));\n    } else {\n      console.warn('There are no more redo left.');\n    }\n  }\n}\n"],"names":["CanvasFreeDrawing","params","elementId","requiredParam","width","height","backgroundColor","lineWidth","strokeColor","disabled","canvas","document","getElementById","checkCanvasElement","context","getContext","alpha","maxSnapshots","snapshots","undos","positions","leftCanvasDrawing","isDrawing","isDrawingModeEnabled","imageRestored","validateColor","bucketToolColor","bucketToolTolerance","isBucketToolEnabled","listenersList","allowedEvents","redrawCounter","dispatchEventsOnceEvery","redrawEvent","Event","mouseUpEvent","mouseDownEvent","mouseEnterEvent","mouseLeaveEvent","touchStartEvent","touchEndEvent","mouseDown","bind","mouseMove","mouseLeave","mouseUp","mouseUpDocument","touchStart","touchMove","touchEnd","touchIdentifier","previousX","previousY","setDimensions","setBackground","enableDrawingMode","param","Error","tagName","newCanvas","createElement","appendChild","forEach","event","addEventListener","toLowerCase","removeEventListener","addListeners","toggleCursor","removeListeners","button","x","pageX","offsetLeft","y","pageY","offsetTop","drawPoint","drawLine","changedTouches","length","identifier","handleEndDrawing","dispatchEvent","storeSnapshot","fill","tolerance","storeDrawing","handleDrawing","isUndo","isRedo","clear","onlyCanvas","undo","pop","push","position","i","isBucket","newColor","storeInPosition","strokeStyle","rgbaFromArray","draw","lineJoin","moving","beginPath","moveTo","lineTo","closePath","stroke","console","log","Promise","resolve","imageData","getImageData","data","targetColor","getNodeColor","isNodeColorEqual","queue","n","w","e","firstNode","lastNode","setNodeColor","putImageData","color","placeholder","validColor","warn","j","t","percentT","diffRed","Math","abs","diffGreen","diffBlue","percentDiffRed","percentDiffGreen","percentDiffBlue","percentDiff","color1","color2","a","style","cursor","getCanvasSnapshot","splice","callback","counter","includes","Number","isInteger","parseInt","px","save","fillStyle","fillRect","configBucketTool","setStrokeColor","disableDrawingMode","clearRect","lastPath","toDataURL","backup","image","Image","src","onload","drawImage","lastSnapshot","goToSnapshot","restoreCanvasSnapshot","lastUndo"],"mappings":"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"}