{"version":3,"file":"canvas-free-drawing.js","sources":["../src/index.js"],"sourcesContent":["var noop = function () { };\nvar CanvasFreeDrawing = /** @class */ (function () {\n    function CanvasFreeDrawing(params) {\n        var elementId = params.elementId, width = params.width, height = params.height, _a = params.backgroundColor, backgroundColor = _a === void 0 ? [255, 255, 255] : _a, _b = params.lineWidth, lineWidth = _b === void 0 ? 5 : _b, strokeColor = params.strokeColor, disabled = params.disabled, _c = params.showWarnings, showWarnings = _c === void 0 ? false : _c, _d = params.maxSnapshots, maxSnapshots = _d === void 0 ? 10 : _d;\n        this.requiredParam(params, 'elementId');\n        this.requiredParam(params, 'width');\n        this.requiredParam(params, 'height');\n        this.elementId = elementId;\n        this.canvasNode = document.getElementById(this.elementId);\n        if (this.canvasNode instanceof HTMLCanvasElement) {\n            this.canvas = this.canvasNode;\n        }\n        else if (this.canvasNode instanceof HTMLElement) {\n            var newCanvas = document.createElement('canvas');\n            this.canvasNode.appendChild(newCanvas);\n            this.canvas = newCanvas;\n        }\n        else {\n            throw new Error(\"No element found with following id: \" + this.elementId);\n        }\n        this.context = this.canvas.getContext('2d');\n        this.width = width;\n        this.height = height;\n        this.maxSnapshots = maxSnapshots;\n        this.snapshots = [];\n        this.undos = [];\n        this.positions = [];\n        this.leftCanvasDrawing = false; // to check if user left the canvas drawing, on mouseover resume drawing\n        this.isDrawing = false;\n        this.isDrawingModeEnabled = true;\n        this.imageRestored = false;\n        this.lineWidth = lineWidth;\n        this.strokeColor = this.toValidColor(strokeColor);\n        this.bucketToolColor = this.toValidColor(strokeColor);\n        this.bucketToolTolerance = 0;\n        this.isBucketToolEnabled = false;\n        this.listenersList = ['mouseDown', 'mouseMove', 'mouseLeave', 'mouseUp', 'touchStart', 'touchMove', 'touchEnd'];\n        this.allowedEvents = ['redraw', 'mouseup', 'mousedown', 'mouseenter', 'mouseleave'];\n        this.redrawCounter = 0;\n        this.dispatchEventsOnceEvery = 0; // this may become something like: [{event, counter}]\n        // initialize events\n        this.events = {\n            redrawEvent: new Event('cfd_redraw'),\n            mouseUpEvent: new Event('cfd_mouseup'),\n            mouseDownEvent: new Event('cfd_mousedown'),\n            mouseEnterEvent: new Event('cfd_mouseenter'),\n            mouseLeaveEvent: new Event('cfd_mouseleave'),\n            touchStartEvent: new Event('cfd_touchstart'),\n            touchEndEvent: new Event('cfd_touchend')\n        };\n        this.bindings = {\n            mouseDown: this.mouseDown.bind(this),\n            mouseMove: this.mouseMove.bind(this),\n            mouseLeave: this.mouseLeave.bind(this),\n            mouseUp: this.mouseUp.bind(this),\n            mouseUpDocument: this.mouseUpDocument.bind(this),\n            touchStart: this.touchStart.bind(this),\n            touchMove: this.touchMove.bind(this),\n            touchEnd: this.touchEnd.bind(this)\n        };\n        // these are needed to remove the listener\n        // this.mouseDown = this.mouseDown.bind(this);\n        // this.mouseMove = this.mouseMove.bind(this);\n        // this.mouseLeave = this.mouseLeave.bind(this);\n        // this.mouseUp = this.mouseUp.bind(this);\n        // this.mouseUpDocument = this.mouseUpDocument.bind(this);\n        // this.touchStart = this.touchStart.bind(this);\n        // this.touchMove = this.touchMove.bind(this);\n        // this.touchEnd = this.touchEnd.bind(this);\n        this.touchIdentifier = undefined;\n        this.previousX = undefined;\n        this.previousY = undefined;\n        this.showWarnings = showWarnings;\n        // cache\n        this.isNodeColorEqualCache = {};\n        this.setDimensions();\n        this.setBackground(backgroundColor);\n        this.storeSnapshot();\n        if (!disabled)\n            this.enableDrawingMode();\n    }\n    CanvasFreeDrawing.prototype.requiredParam = function (object, param) {\n        if (!object || !object[param]) {\n            throw new Error(param + \" is required\");\n        }\n    };\n    CanvasFreeDrawing.prototype.logWarning = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.showWarnings)\n            console.warn.apply(console, args);\n    };\n    CanvasFreeDrawing.prototype.addListeners = function () {\n        var _this = this;\n        this.listenersList.forEach(function (event) {\n            _this.canvas.addEventListener(event.toLowerCase(), _this.bindings[event]);\n        });\n        document.addEventListener('mouseup', this.bindings.mouseUpDocument);\n    };\n    CanvasFreeDrawing.prototype.removeListeners = function () {\n        var _this = this;\n        this.listenersList.forEach(function (event) {\n            _this.canvas.removeEventListener(event.toLowerCase(), _this.bindings[event]);\n        });\n        document.removeEventListener('mouseup', this.bindings.mouseUpDocument);\n    };\n    CanvasFreeDrawing.prototype.enableDrawingMode = function () {\n        this.isDrawingModeEnabled = true;\n        this.addListeners();\n        this.toggleCursor();\n        return this.isDrawingModeEnabled;\n    };\n    CanvasFreeDrawing.prototype.disableDrawingMode = function () {\n        this.isDrawingModeEnabled = false;\n        this.removeListeners();\n        this.toggleCursor();\n        return this.isDrawingModeEnabled;\n    };\n    CanvasFreeDrawing.prototype.mouseDown = function (event) {\n        if (event.button !== 0)\n            return;\n        var x = event.pageX - this.canvas.offsetLeft;\n        var y = event.pageY - this.canvas.offsetTop;\n        this.drawPoint(x, y);\n    };\n    CanvasFreeDrawing.prototype.mouseMove = function (event) {\n        var x = event.pageX - this.canvas.offsetLeft;\n        var y = event.pageY - this.canvas.offsetTop;\n        this.drawLine(x, y, event);\n    };\n    CanvasFreeDrawing.prototype.touchStart = function (event) {\n        if (event.changedTouches.length > 0) {\n            var _a = event.changedTouches[0], pageX = _a.pageX, pageY = _a.pageY, identifier = _a.identifier;\n            var x = pageX - this.canvas.offsetLeft;\n            var y = pageY - this.canvas.offsetTop;\n            this.touchIdentifier = identifier;\n            this.drawPoint(x, y);\n        }\n    };\n    CanvasFreeDrawing.prototype.touchMove = function (event) {\n        if (event.changedTouches.length > 0) {\n            var _a = event.changedTouches[0], pageX = _a.pageX, pageY = _a.pageY, identifier = _a.identifier;\n            var x = pageX - this.canvas.offsetLeft;\n            var y = pageY - this.canvas.offsetTop;\n            // check if is multi touch, if it is do nothing\n            if (identifier != this.touchIdentifier)\n                return;\n            this.previousX = x;\n            this.previousY = y;\n            this.drawLine(x, y, event);\n        }\n    };\n    CanvasFreeDrawing.prototype.touchEnd = function () {\n        this.handleEndDrawing();\n        this.canvas.dispatchEvent(this.events.touchEndEvent);\n    };\n    CanvasFreeDrawing.prototype.mouseUp = function () {\n        this.handleEndDrawing();\n        this.canvas.dispatchEvent(this.events.mouseUpEvent);\n    };\n    CanvasFreeDrawing.prototype.mouseUpDocument = function () {\n        this.leftCanvasDrawing = false;\n    };\n    CanvasFreeDrawing.prototype.mouseLeave = function () {\n        if (this.isDrawing)\n            this.leftCanvasDrawing = true;\n        this.isDrawing = false;\n        this.canvas.dispatchEvent(this.events.mouseLeaveEvent);\n    };\n    CanvasFreeDrawing.prototype.mouseEnter = function () {\n        this.canvas.dispatchEvent(this.events.mouseEnterEvent);\n    };\n    CanvasFreeDrawing.prototype.handleEndDrawing = function () {\n        this.isDrawing = false;\n        this.storeSnapshot();\n    };\n    CanvasFreeDrawing.prototype.drawPoint = function (x, y) {\n        if (this.isBucketToolEnabled) {\n            this.fill(x, y, this.bucketToolColor, { tolerance: this.bucketToolTolerance });\n        }\n        this.isDrawing = true;\n        this.storeDrawing(x, y, false);\n        this.canvas.dispatchEvent(this.events.mouseDownEvent);\n        this.handleDrawing();\n    };\n    CanvasFreeDrawing.prototype.drawLine = function (x, y, event) {\n        if (this.leftCanvasDrawing) {\n            this.leftCanvasDrawing = false;\n            if (event instanceof MouseEvent) {\n                this.mouseDown(event);\n            }\n            else if (event instanceof TouchEvent) {\n                this.touchEnd();\n            }\n        }\n        if (this.isDrawing) {\n            this.storeDrawing(x, y, true);\n            this.handleDrawing(this.dispatchEventsOnceEvery);\n        }\n    };\n    CanvasFreeDrawing.prototype.handleDrawing = function (dispatchEventsOnceEvery) {\n        var _this = this;\n        this.context.lineJoin = 'round';\n        var positions = [this.positions.slice().pop()];\n        positions.forEach(function (position) {\n            if (position && position[0] && position[0].strokeColor) {\n                _this.context.strokeStyle = _this.rgbaFromArray(position[0].strokeColor);\n                _this.context.lineWidth = position[0].lineWidth;\n                _this.draw(position);\n            }\n        });\n        if (!dispatchEventsOnceEvery) {\n            this.canvas.dispatchEvent(this.events.redrawEvent);\n        }\n        else if (this.redrawCounter % dispatchEventsOnceEvery === 0) {\n            this.canvas.dispatchEvent(this.events.redrawEvent);\n        }\n        this.undos = [];\n        this.redrawCounter += 1;\n    };\n    CanvasFreeDrawing.prototype.draw = function (position) {\n        var _this = this;\n        position.forEach(function (_a, i) {\n            var x = _a.x, y = _a.y, moving = _a.moving;\n            _this.context.beginPath();\n            if (moving && i) {\n                _this.context.moveTo(position[i - 1]['x'], position[i - 1]['y']);\n            }\n            else {\n                _this.context.moveTo(x - 1, y);\n            }\n            _this.context.lineTo(x, y);\n            _this.context.closePath();\n            _this.context.stroke();\n        });\n    };\n    // https://en.wikipedia.org/wiki/Flood_fill\n    CanvasFreeDrawing.prototype.fill = function (x, y, newColor, _a) {\n        var tolerance = _a.tolerance;\n        newColor = this.toValidColor(newColor);\n        if (this.positions.length === 0 && !this.imageRestored) {\n            this.setBackground(newColor, false);\n            this.canvas.dispatchEvent(this.events.redrawEvent);\n            return;\n        }\n        var imageData = this.context.getImageData(0, 0, this.width, this.height);\n        var newData = imageData.data;\n        var targetColor = this.getNodeColor(x, y, newData);\n        if (this.isNodeColorEqual(targetColor, newColor, tolerance))\n            return;\n        var queue = [];\n        queue.push([x, y]);\n        while (queue.length) {\n            if (queue.length > this.width * this.height)\n                break;\n            var n = queue.pop();\n            var w = n;\n            var e = n;\n            while (this.isNodeColorEqual(this.getNodeColor(w[0] - 1, w[1], newData), targetColor, tolerance)) {\n                w = [w[0] - 1, w[1]];\n            }\n            while (this.isNodeColorEqual(this.getNodeColor(e[0] + 1, e[1], newData), targetColor, tolerance)) {\n                e = [e[0] + 1, e[1]];\n            }\n            var firstNode = w[0];\n            var lastNode = e[0];\n            for (var i = firstNode; i <= lastNode; i++) {\n                this.setNodeColor(i, w[1], newColor, newData);\n                if (this.isNodeColorEqual(this.getNodeColor(i, w[1] + 1, newData), targetColor, tolerance)) {\n                    queue.push([i, w[1] + 1]);\n                }\n                if (this.isNodeColorEqual(this.getNodeColor(i, w[1] - 1, newData), targetColor, tolerance)) {\n                    queue.push([i, w[1] - 1]);\n                }\n            }\n        }\n        this.context.putImageData(imageData, 0, 0);\n        this.canvas.dispatchEvent(this.events.redrawEvent);\n    };\n    CanvasFreeDrawing.prototype.toValidColor = function (color) {\n        if (Array.isArray(color) && color.length === 4)\n            color.pop();\n        if (Array.isArray(color) && color.length === 3) {\n            var validColor = color.slice();\n            validColor.push(255);\n            return validColor;\n        }\n        else {\n            this.logWarning('Color is not valid! It must be an array with RGB values:  [0-255, 0-255, 0-255]');\n            return [0, 0, 0, 255];\n        }\n    };\n    // i = color 1; j = color 2; t = tolerance\n    CanvasFreeDrawing.prototype.isNodeColorEqual = function (i, j, t) {\n        // const color1 = JSON.stringify(i);\n        // const color2 = JSON.stringify(j);\n        var color1 = '' + i[0] + i[1] + i[2] + i[3];\n        var color2 = '' + j[0] + j[1] + j[2] + j[3];\n        var key = color1 + color2 + t;\n        t = t || 0;\n        if (this.isNodeColorEqualCache.hasOwnProperty(color1 + color2 + t)) {\n            return this.isNodeColorEqualCache[key];\n        }\n        var diffRed = Math.abs(j[0] - i[0]);\n        var diffGreen = Math.abs(j[1] - i[1]);\n        var diffBlue = Math.abs(j[2] - i[2]);\n        var percentDiffRed = diffRed / 255;\n        var percentDiffGreen = diffGreen / 255;\n        var percentDiffBlue = diffBlue / 255;\n        var percentDiff = ((percentDiffRed + percentDiffGreen + percentDiffBlue) / 3) * 100;\n        var result = t >= percentDiff;\n        this.isNodeColorEqualCache[key] = result;\n        return result;\n    };\n    CanvasFreeDrawing.prototype.getNodeColor = function (x, y, data) {\n        var i = (x + y * this.width) * 4;\n        return [data[i], data[i + 1], data[i + 2], data[i + 3]];\n    };\n    CanvasFreeDrawing.prototype.setNodeColor = function (x, y, color, data) {\n        var i = (x + y * this.width) * 4;\n        data[i] = color[0];\n        data[i + 1] = color[1];\n        data[i + 2] = color[2];\n        data[i + 3] = color[3];\n    };\n    CanvasFreeDrawing.prototype.rgbaFromArray = function (a) {\n        return \"rgba(\" + a[0] + \",\" + a[1] + \",\" + a[2] + \",\" + a[3] + \")\";\n    };\n    CanvasFreeDrawing.prototype.setDimensions = function () {\n        this.canvas.height = this.height;\n        this.canvas.width = this.width;\n    };\n    CanvasFreeDrawing.prototype.toggleCursor = function () {\n        this.canvas.style.cursor = this.isDrawingModeEnabled ? 'crosshair' : 'auto';\n    };\n    CanvasFreeDrawing.prototype.storeDrawing = function (x, y, moving) {\n        if (moving) {\n            var lastIndex = this.positions.length - 1;\n            this.positions[lastIndex].push({\n                x: x,\n                y: y,\n                moving: moving,\n                lineWidth: this.lineWidth,\n                strokeColor: this.strokeColor,\n                isBucket: false\n            });\n        }\n        else {\n            this.positions.push([\n                {\n                    x: x,\n                    y: y,\n                    isBucket: false,\n                    moving: moving,\n                    lineWidth: this.lineWidth,\n                    strokeColor: this.strokeColor\n                },\n            ]);\n        }\n    };\n    CanvasFreeDrawing.prototype.storeSnapshot = function () {\n        var imageData = this.getCanvasSnapshot();\n        this.snapshots.push(imageData);\n        if (this.snapshots.length > this.maxSnapshots) {\n            this.snapshots = this.snapshots.splice(-Math.abs(this.maxSnapshots));\n        }\n    };\n    CanvasFreeDrawing.prototype.getCanvasSnapshot = function () {\n        return this.context.getImageData(0, 0, this.width, this.height);\n    };\n    CanvasFreeDrawing.prototype.restoreCanvasSnapshot = function (imageData) {\n        this.context.putImageData(imageData, 0, 0);\n    };\n    // Public APIs\n    CanvasFreeDrawing.prototype.on = function (params, callback) {\n        var event = params.event, counter = params.counter;\n        this.requiredParam(params, 'event');\n        if (this.allowedEvents.includes(event)) {\n            if (event === 'redraw' && counter && Number.isInteger(counter)) {\n                this.dispatchEventsOnceEvery = counter;\n            }\n            this.canvas.addEventListener('cfd_' + event, function () { return callback(); });\n        }\n        else {\n            this.logWarning(\"This event is not allowed: \" + event);\n        }\n    };\n    CanvasFreeDrawing.prototype.setLineWidth = function (px) {\n        this.lineWidth = px;\n    };\n    CanvasFreeDrawing.prototype.setBackground = function (color, save) {\n        if (save === void 0) { save = true; }\n        var validColor = this.toValidColor(color);\n        if (validColor) {\n            if (save)\n                this.backgroundColor = validColor;\n            this.context.fillStyle = this.rgbaFromArray(validColor);\n            this.context.fillRect(0, 0, this.width, this.height);\n        }\n    };\n    CanvasFreeDrawing.prototype.setDrawingColor = function (color) {\n        this.configBucketTool({ color: color });\n        this.setStrokeColor(color);\n    };\n    CanvasFreeDrawing.prototype.setStrokeColor = function (color) {\n        this.strokeColor = this.toValidColor(color);\n    };\n    CanvasFreeDrawing.prototype.configBucketTool = function (params) {\n        var _a = params.color, color = _a === void 0 ? null : _a, _b = params.tolerance, tolerance = _b === void 0 ? null : _b;\n        if (color)\n            this.bucketToolColor = this.toValidColor(color);\n        if (tolerance && tolerance > 0) {\n            this.bucketToolTolerance = tolerance > 100 ? 100 : tolerance;\n        }\n    };\n    CanvasFreeDrawing.prototype.toggleBucketTool = function () {\n        return (this.isBucketToolEnabled = !this.isBucketToolEnabled);\n    };\n    CanvasFreeDrawing.prototype.toggleDrawingMode = function () {\n        return this.isDrawingModeEnabled ? this.disableDrawingMode() : this.enableDrawingMode();\n    };\n    CanvasFreeDrawing.prototype.clear = function () {\n        this.context.clearRect(0, 0, this.width, this.height);\n        this.positions = [];\n        if (this.backgroundColor)\n            this.setBackground(this.backgroundColor);\n        this.handleEndDrawing();\n    };\n    CanvasFreeDrawing.prototype.save = function () {\n        return this.canvas.toDataURL();\n    };\n    CanvasFreeDrawing.prototype.restore = function (backup, callback) {\n        var _this = this;\n        var image = new Image();\n        image.src = backup;\n        image.onload = function () {\n            _this.imageRestored = true;\n            _this.context.drawImage(image, 0, 0);\n            if (typeof callback === 'function')\n                callback();\n        };\n    };\n    CanvasFreeDrawing.prototype.undo = function () {\n        var lastSnapshot = this.snapshots[this.snapshots.length - 1];\n        var goToSnapshot = this.snapshots[this.snapshots.length - 2];\n        if (goToSnapshot) {\n            this.restoreCanvasSnapshot(goToSnapshot);\n            this.snapshots.pop();\n            this.undos.push(lastSnapshot);\n            this.undos = this.undos.splice(-Math.abs(this.maxSnapshots));\n        }\n        else {\n            this.logWarning('There are no more undos left.');\n        }\n    };\n    CanvasFreeDrawing.prototype.redo = function () {\n        if (this.undos.length > 0) {\n            var lastUndo = this.undos.pop();\n            if (lastUndo) {\n                this.restoreCanvasSnapshot(lastUndo);\n                this.snapshots.push(lastUndo);\n                this.snapshots = this.snapshots.splice(-Math.abs(this.maxSnapshots));\n            }\n        }\n        else {\n            this.logWarning('There are no more redo left.');\n        }\n    };\n    return CanvasFreeDrawing;\n}());\nexport default CanvasFreeDrawing;\n"],"names":["CanvasFreeDrawing","params","elementId","width","height","_a","backgroundColor","_b","lineWidth","strokeColor","disabled","_c","showWarnings","_d","maxSnapshots","requiredParam","canvasNode","document","getElementById","HTMLCanvasElement","canvas","HTMLElement","newCanvas","createElement","appendChild","Error","context","getContext","snapshots","undos","positions","leftCanvasDrawing","isDrawing","isDrawingModeEnabled","imageRestored","toValidColor","bucketToolColor","bucketToolTolerance","isBucketToolEnabled","listenersList","allowedEvents","redrawCounter","dispatchEventsOnceEvery","events","redrawEvent","Event","mouseUpEvent","mouseDownEvent","mouseEnterEvent","mouseLeaveEvent","touchStartEvent","touchEndEvent","bindings","mouseDown","bind","mouseMove","mouseLeave","mouseUp","mouseUpDocument","touchStart","touchMove","touchEnd","touchIdentifier","undefined","previousX","previousY","isNodeColorEqualCache","setDimensions","setBackground","storeSnapshot","enableDrawingMode","prototype","object","param","logWarning","args","_i","arguments","length","console","warn","apply","addListeners","_this","forEach","event","addEventListener","toLowerCase","removeListeners","removeEventListener","toggleCursor","disableDrawingMode","button","x","pageX","offsetLeft","y","pageY","offsetTop","drawPoint","drawLine","changedTouches","identifier","handleEndDrawing","dispatchEvent","mouseEnter","fill","tolerance","storeDrawing","handleDrawing","MouseEvent","TouchEvent","lineJoin","slice","pop","position","strokeStyle","rgbaFromArray","draw","i","moving","beginPath","moveTo","lineTo","closePath","stroke","newColor","imageData","getImageData","newData","data","targetColor","getNodeColor","isNodeColorEqual","queue","push","n","w","e","firstNode","lastNode","setNodeColor","putImageData","color","Array","isArray","validColor","j","t","color1","color2","key","hasOwnProperty","diffRed","Math","abs","diffGreen","diffBlue","percentDiffRed","percentDiffGreen","percentDiffBlue","percentDiff","result","a","style","cursor","lastIndex","isBucket","getCanvasSnapshot","splice","restoreCanvasSnapshot","on","callback","counter","includes","Number","isInteger","setLineWidth","px","save","fillStyle","fillRect","setDrawingColor","configBucketTool","setStrokeColor","toggleBucketTool","toggleDrawingMode","clear","clearRect","toDataURL","restore","backup","image","Image","src","onload","drawImage","undo","lastSnapshot","goToSnapshot","redo","lastUndo"],"mappings":"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"}